### 発想標語に対応する演奏見本システム

#### システム実行に必要なもの  
① music_expression.py　(メイン)  
② lilypond-2.24.4-mingw-x86_64　(楽譜表示)  
　⇒ music_expression.py内でlilypond-2.24.4-mingw-x86_64\lilypond-2.24.4\bin\musicxml2ly.pyを呼び出すため  
③ 演奏データ (MIDI)  
④ 楽譜データ (MusicXML)  
⑤ MuseScore (フレーズ選択用)  
➅ PharaseSelector.qml (MuseScoreのプラグイン)  
　※MuseScore 3.x,4.xどちらも使えるが、4.xではプラグインクリエーター(コンソール)がないのでデバッグするなら3.xを使用  
⑦ (JSONファイル)  
　⇒⑤➅のプラグイン実行で生成される  
 　・music_expression.pyがあるディレクトリにJSONフォルダを作成して、➅PharaseSelector.qmlでJSONのパスを自分のパスに変更  
  
#### 事前準備
【MuseScore】   
💡MuseScoreのプラグインを有効にする  
　・エクスプローラー→"MuseScore(3 or 4)/Plugins"内に➅ PharaseSelector.qmlを置く   
　＜MuseScore 3.x＞  
　・プラグイン＞プラグインマネージャー＞PhraseSelectorにチェックを入れてOkを押す  
　＜MuseScore 4.x＞   
 　・プラグイン＞プラグインを管理＞PhraseSelectorを押して有効化  
  
【Python(VSCode)】  
・music_expression.py と lilypond-2.24.4-mingw-x86_64 は同じワークスペースに配置

#### 操作方法  
【MuseScore】  
1. MuseScoreで楽譜を開く(MusicXMl or .mscz)
2. フレーズ範囲を選択する(開始の音符をクリック、終了の音符をshift+クリックで範囲選択)  
3. プラグイン＞フレーズ範囲取得　を押す  
4. JSONファイルの保存ポップアップが表示されるので、ファイル名を入力して保存  

【Python】
1. music_expression.pyを実行する  
2. GUI左上の"開く(MusicXML)"を押して楽譜データ(MusicXML形式)を選択する
   読み込みが完了すると、左側の"パートのリスト"にMIDIファイルに含まれるパート名が表示される  
3. 2.の下にある"開く(MIDI)"を押して演奏データ(MIDI)を選択する  
4. 左下の"パートの選択"からパートを選択する  
   選択されたパートの楽譜が中央にPNG画像として表示される(表示までに少し時間がかかる)
5. 右上の"フレーズを読み込み(.json)"で保存したJSONファイルを選択する  
   ファイル選択すると開始小節、開始拍、終了小節、終了拍に数値が入力される(変更も可能)
6. 頂点の小節、拍の情報を入力する(数値)  
   拍は小数点以下で指定可能（例：2拍半(2.5拍)→2.5）
7. "フレーズをハイライト"を押すとフレーズ範囲に色がついた楽譜が表示される  
　　フレーズ範囲：水色、頂点：ピンク  
8. 頂点拍の下にあるドロップダウンメニュー(🔽)から適用したい表現を選択する  
   ・発想標語プリセット："Cantabile"、"Dolce"などの発想標語を選択する  
   ・形容詞プリセット："明るい"、"華やか"などの形容詞を選択する  
   💡発想標語プリセットと形容詞プリセットは同時に選択できない  
   　 どちらか一方を選択すると、もう一方は自動的に「なし」にリセットされる  
9. フレーズ設定と表現プリセットの入力が完了したら、右下にある"適用"ボタンを押す  
   選択したパートに強弱(CC#2)の補間と発音時刻の調整が適用される  
   全てのパートに対して指定したフレーズ間の発音時刻の調整が適用され、曲全体のテンポ変化が統一される  
   他にも適用させたいフレーズがある場合は4.に戻る
10. 右下の"保存"ボタンを押すと結果がMIDIファイルとして保存される  
   以下の2種類のMIDIファイルが保存される  
   ・加工されたパートのみのMIDIファイル：output(single_part_midi)フォルダに"曲名_パート名_連番.mid"の形式で保存される  
   ・全パート（加工されたパートを含む）のMIDIファイル：output(midi)フォルダに"曲名_full_連番.mid"の形式で保存される  
   すでに同じ曲がフォルダの中にある場合は連番で表示される(曲名1_full_01.mid,曲名1_full_02.mid)  

#### 出力ファイルについて
演奏表現が適用されたMIDIファイルはoutput(single_part_midi),output(midi)フォルダに保存される  
また、楽譜表示の際に以下のフォルダにファイルが生成される  
・output(png)：GUIに表示用の楽譜画像(PNG)  
・output(xml)：選択したパートの楽譜ファイル(MusicXML形式)  
・output(ly)：選択したパートの楽譜ファイル(LilyPond)  
